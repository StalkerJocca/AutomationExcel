<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dashboard</title>
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/css/bootstrap.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.8.1/font/bootstrap-icons.css">
  <style>
    .sidebar {
      background-color: #333;
      padding-top: 2%;
      height: 100%;
      position: fixed;
      left: 0;
      top: 50px; /* adjusted top position to account for top bar */
      width: 200px;
      transition: left 0.5s;
    }
    .logo{
      text-align: center;
      margin-left: 5px;
      margin-bottom: 20px;
    }
    .main-content {
      padding: 30px;
      margin-left: 200px;
      margin-top: 50px; /* adjusted top margin to account for top bar */
    }
    .project-dashboard .progress {
      height: 30px;
      margin-bottom: 20px;
      background-color: #f0f0f0;
      border-radius: 10px;
      overflow: hidden;
    }

    .project-dashboard .progress-bar {
      background-color: #055269; /* Bootstrap's primary color */
      transition: width 0.5s ease;
    }

    .project-dashboard .progress-text {
      font-size: 15px;
      color: #fff;
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
    }
    .hide-sidebar {
      left: -200px;
    }
    .main-content-hide {
      margin-left: 0;
    }
    .top-bar {
      background-color: #333;
      color: #fff;
      padding: 10px;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      z-index: 1;
    }
    .sidebar-toggle-container {
      position: fixed;
      top: 50px; /* adjust to match the top bar height */
      left: 0;
      z-index: 1;
    }
    .fixed-bottom-row {
      position: relative;
      bottom: 0;
      left: 0;
      width: 100%;
      background-color: #333; /* Optional background color */
      padding: 10px;
      text-align: left;
    }
    .graphics-area {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px;
      background-color: #f7f7f7;
      border: 1px solid #ddd;
      border-radius: 10px;
      box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    }

    .graphic {
      width: 100%;
      height: 200px; /* Set a fixed height for the canvas */
      margin: 10px;
      border-radius: 10px;
    }

    .signature {
      font-size: 14px;
      margin-left: 15px;
      color: #ffffff; /* Optional text color */
    }
    /* Add these styles to make the icon responsive and aligned to the left */
    #sidebar-toggle-icon {
      font-size: 24px;
      margin-left: 10px;
      margin-right: 10px;
      vertical-align: middle;
    }
    @media (max-width: 768px) {
      #sidebar-toggle-icon {
        font-size: 18px;
      }
    }
  </style>
</head>
<body>
  <div class="top-bar">
    <div class="container">
      <div class="row">
        <div class="col-md-2 text-left">
          <img src="./Images/logo-horizontal-blue.png" alt="Logo" width="auto" height="50 px">
          <!-- <span>PROJECTS DASHBOARD</span> -->
        </div>
        <div class="col-md-10 text-right">
          <button class="btn btn-outline-primary" id="show-btn">
            <i class="bi bi-list" id="sidebar-toggle-icon"></i>
          </button>
        </div>
      </div>
    </div>
  </div>
  <div class="container-fluid">
    <div class="row">
      <div class="col-xs-2 col-md-2 col-lg-2 sidebar hide-sidebar">
        <!-- <img src="./Images/logo-horizontal-blue.png" alt="Logo" width="auto" height="60px" class="logo"> -->
        <nav class="navbar navbar-expand-lg navbar-light">
          <div class="collapse navbar-collapse" id="navbarSupportedContent">
            <ul class="navbar-nav flex-column">
              <li class="nav-item">
                <a class="nav-link bi bi-music-note-beamed text-light" href="#project1"> CONCERTO</a>
              </li>
              <li class="nav-item">
                <a class="nav-link bi bi-compass text-light" href="#project2"> COMPASS</a>
              </li>
              <li class="nav-item">
                <a class="nav-link bi bi-strava text-light" href="#project3"> K-TECH AGILE</a>
              </li>
              <li class="nav-item">
                <a class="nav-link bi bi-boxes text-light" href="#project4"> JENKINS</a>
              </li>
            </ul>
          </div>
        </nav>
      </div>
      <div class="col-xs-10 col-md-10 col-lg-10 main-content main-content-hide">
        <br>

        <h1 class="p-3 mb-2 bg-dark text-light bi bi-kanban-fill"> - PROJECTS</h1>
        <p class="p-3 mb-2 bg-light text-dark">AREA TO DISPLAY DASHBOARDS OF PROJECTS</p>
        
        <hr class="hr hr-blurry" />

        <div class="project-dashboard">
          <h2 class="p-3 mb-2 bg-dark text-light bi bi-music-note-beamed">Project 1</h2>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 60%;" aria-valuenow="60" aria-valuemin="0" aria-valuemax="100">
              <span class="progress-text">60%</span>
            </div>
          </div>
          <h2 class="p-3 mb-2 bg-dark text-light bi bi-compass">Project 2</h2>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 30%;" aria-valuenow="30" aria-valuemin="0" aria-valuemax="100">
              <span class="progress-text">30%</span>
            </div>
          </div>
          <h2 class="p-3 mb-2 bg-dark text-light bi bi-strava">Project 3</h2>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 90%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100">
              <span class="progress-text">90%</span>
            </div>
          </div>
          <h2 class="p-3 mb-2 bg-dark text-light bi bi-boxes">Project 4</h2>
          <div class="progress">
            <div class="progress-bar" role="progressbar" style="width: 90%;" aria-valuenow="90" aria-valuemin="0" aria-valuemax="100">
              <span class="progress-text">90%</span>
            </div>
          </div>

          <hr class="hr hr-blurry" />
          
          <button class="btn btn-primary" id="create-new-project">Include new Project</button>

          <br>
          
          <!-- We'll dynamically generate new project DIVs here -->
          <div id="projects-container"></div>

          <hr class="hr hr-blurry" />

          <div class="graphics-area">
            <canvas id="graphic-1" class="graphic"></canvas>
            <canvas id="graphic-2" class="graphic"></canvas>
          </div>


          
        </div>

      </div>
      <div class="fixed-bottom-row">
        <p class="signature">João Carlos Costa<sup>®</sup></p>
        <p class="signature">Project Manager | Scrum Master </p>
      </div>
  </div>
  <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <script>

    // ONCLICK BUTTON FOR SIDEBAR
    
    $(document).ready(function() {
      $('#show-btn').click(function() {
        $('.sidebar').toggleClass('hide-sidebar');
        $('.main-content').toggleClass('main-content-hide');
        if ($('#sidebar-toggle-icon').hasClass('bi-list')) {
          $('#sidebar-toggle-icon').removeClass('bi-list').addClass('bi-list-nested');
        } else {
          $('#sidebar-toggle-icon').removeClass('bi-list-nested').addClass('bi-list');
        }
      });
    });

     // FETCH NAMES DISPLAY AND PROGRESS BBARS

    // Step 1: Load the projects.json file
    fetch('projects_evolution.json')
      .then(response => response.json())
      .then(projects => {
        // Step 2: Parse the JSON data into a JavaScript object

        // Step 3: Replace the text inside the <h2> tags with the corresponding project names
        // and update the progress bars
        $('.project-dashboard h2').each((index, h2) => {
          // Get the corresponding project object based on the index
          const project = projects[index];

          // Replace the text inside the <h2> tag with the project name
          $(h2).text(project.name);

          // Update the progress bar
          const progressBar = $(h2).next('.progress').find('.progress-bar');
          progressBar.css('width', `${project.progress}%`);
          progressBar.attr('aria-valuenow', project.progress);
          progressBar.text(`${project.progress}%`);
        });
      })
      .catch(error => {
        console.error('Error loading projects.json:', error);
      });


    // CREATION OF BUTTON FOR PROJECT CREATION

    const projectsContainer = document.getElementById('projects-container');
    const createNewProjectButton = document.getElementById('create-new-project');

    createNewProjectButton.addEventListener('click', createNewProject);

    function createNewProject() {
  // Get the new project information from the user (e.g., project name, progress percentage)
  const newProjectName = prompt('Enter new project name:');
  const newProjectProgress = prompt('Enter new project progress (0-100):');

  // Create a new project object
  const newProject = {
    name: newProjectName,
    progress: parseInt(newProjectProgress)
  };

  // Load existing projects from local storage
  let projectsJSON = localStorage.getItem('projects');
  if (!projectsJSON) {
    projectsJSON = { projects: [] };
  } else {
    projectsJSON = JSON.parse(projectsJSON);
  }

  // Add the new project to the JSON file
  projectsJSON.projects.push(newProject);

  // Save the updated JSON file to local storage
  localStorage.setItem('projects', JSON.stringify(projectsJSON));

  // Write the updated data to the projects_evolution.json file
  const fs = require('fs');
  fs.writeFileSync('projects_evolution.json', JSON.stringify(projectsJSON, null, 2));

  // Dynamically generate a new DIV element for the new project
  const newProjectDiv = document.createElement('div');
  newProjectDiv.className = 'progress';
  newProjectDiv.innerHTML = `
    <div class="progress-bar" role="progressbar" style="width: ${newProjectProgress}%; aria-valuenow="${newProjectProgress}" aria-valuemin="0" aria-valuemax="100">
      <span class="progress-text">${newProjectProgress}%</span>
    </div>
    <span>${newProjectName}</span>
  `;
  projectsContainer.appendChild(newProjectDiv);
}

    // Load projects from local storage and display them
    function loadProjects() {
      const projectsJSON = localStorage.getItem('projects');
      if (projectsJSON) {
        const projects = JSON.parse(projectsJSON).projects;
          projects.forEach((project) => {
            const projectDiv = document.createElement('div');
            projectDiv.className = 'progress';
            projectDiv.innerHTML = `
              <div class="progress-bar" role="progressbar" style="width: ${project.progress}%; aria-valuenow="${project.progress}" aria-valuemin="0" aria-valuemax="100">
                <span class="progress-text">${project.progress}%</span>
              </div>
              <span>${project.name}</span>
            `;
            projectsContainer.appendChild(projectDiv);
          });
        }
      }

      loadProjects();

      localStorage.setItem('projects', JSON.stringify({ projects: [] }));


      // Load the JSON file
    fetch('concerto_metrics.json')
      .then(response => response.json())
      .then(data => {
        // Extract the data for the two graphics
        const sprints = data.Concerto.map(item => item.sprint);
        const expectedTickets = data.Concerto.map(item => parseInt(item.expected_tickets));
        const totalTickets = data.Concerto.map(item => parseInt(item.total_tickets));
        const percentagePlannedSprint = data.Concerto.map(item => parseFloat(item.percentage_planned_sprint.replace('%', '')));
        const statusSprint = data.Concerto.map(item => parseFloat(item.status_sprint.replace('%', '')));

        // Define colors for the bars
        const plannedColor = '#333'; // BLACK
        const statusColor = '#666'; // GRAY

        // Generate graphic 1: Sprint vs Expected Tickets vs Total Tickets
        const graphic1 = document.getElementById('graphic-1');
        const ctx1 = graphic1.getContext('2d');
        ctx1.font = '10px Arial';
        ctx1.textAlign = 'center';
        ctx1.textBaseline = 'middle';

        // Draw x-axis
        ctx1.beginPath();
        ctx1.moveTo(20, graphic1.height - 20); // Move x-axis to the right
        ctx1.lineTo(graphic1.width, graphic1.height - 20);
        ctx1.stroke();

        // Draw x-axis labels
        const numSprintsToShow = 2;
        for (let i = 0; i < numSprintsToShow; i++) {
          ctx1.fillText(sprints[i], (i * 50) + 120, graphic1.height - 10); // Move labels to the right
        }

        // Draw bars
        for (let i = 0; i < numSprintsToShow; i++) {
          ctx1.fillStyle = plannedColor;
          ctx1.fillRect(i * 50 + 100, graphic1.height - 30, 20, -expectedTickets[i]); // Move bars to the right
          ctx1.font = '10px Arial';
          ctx1.textAlign = 'center';
          ctx1.textBaseline = 'middle';
          ctx1.fillText(expectedTickets[i], i * 50 + 110, graphic1.height - 40 - expectedTickets[i]);

          ctx1.fillStyle = statusColor;
          ctx1.fillRect(i * 50 + 125, graphic1.height - 30, 20, -totalTickets[i]); // Move bars to the right
          ctx1.font = '10px Arial';
          ctx1.textAlign = 'center';
          ctx1.textBaseline = 'middle';
          ctx1.fillText(totalTickets[i], i * 50 + 135, graphic1.height - 40 - totalTickets[i]);
        }

        // Add title and labels
        ctx1.font = '12px Arial';
        ctx1.textAlign = 'left';
        ctx1.textBaseline = 'top';
        ctx1.fillText('Sprint Tickets', 20, 8); // Move title to the right
        ctx1.font = '10px Arial';
        ctx1.textAlign = 'right';
        ctx1.textBaseline = 'middle';
        ctx1.fillText('Expected Scope', graphic1.width - 10, graphic1.height / 2);
        ctx1.fillText('Total Scope', graphic1.width - 10, graphic1.height / 2 + 20);

        // Generate graphic 2: Sprint vs Percentage Planned Sprint vs Status Sprint
        const graphic2 = document.getElementById('graphic-2');
        const ctx2 = graphic2.getContext('2d');
        ctx2.font = '10px Arial';
        ctx2.textAlign = 'right';
        ctx2.textBaseline = 'middle';

        // Draw x-axis
        ctx2.beginPath();
        ctx2.moveTo(20, graphic2.height - 20); // Move x-axis to the right
        ctx2.lineTo(graphic2.width, graphic2.height - 20);
        ctx2.stroke();

        // Draw x-axis labels
        const numSprintsToShow_R = 2;
        for (let i = 0; i < numSprintsToShow_R; i++) {
          ctx2.fillText(sprints[i], (i * 50) + 145, graphic2.height - 10); // Move labels to the right
        }

        // Draw bars
      for (let i = 0; i < numSprintsToShow_R; i++) {
        ctx2.fillStyle = plannedColor;
        ctx2.fillRect(i * 50 + 100, graphic2.height - 30, 20, -percentagePlannedSprint[i] / 2); // Move bars to the right
        ctx2.font = '10px Arial';
        ctx2.textAlign = 'center';
        ctx2.textBaseline = 'middle';
        ctx2.fillText(percentagePlannedSprint[i] + '%', i * 50 + 110, graphic2.height - 40 - percentagePlannedSprint[i] / 2);

        ctx2.fillStyle = statusColor;
        ctx2.fillRect(i * 50 + 125, graphic2.height - 30, 20, -statusSprint[i] / 2); // Move bars to the right
        ctx2.font = '10px Arial';
        ctx2.textAlign = 'center';
        ctx2.textBaseline = 'middle';
        ctx2.fillText(statusSprint[i] + '%', i * 50 + 135, graphic2.height - 40 - statusSprint[i] / 2);
      }

      // Add title and labels
      ctx2.font = '12px Arial';
      ctx2.textAlign = 'left';
      ctx2.textBaseline = 'top';
      ctx2.fillText('Sprint Progress', 20, 8); // Move title to the right
      ctx2.font = '10px Arial';
      ctx2.textAlign = 'right';
      ctx2.textBaseline = 'middle';
      ctx2.fillText('% Planned', graphic2.width - 10, graphic2.height / 2);
      ctx2.fillText('% Achieved', graphic2.width - 10, graphic2.height / 2 + 20);
      });
  </script>

</body>
</html>